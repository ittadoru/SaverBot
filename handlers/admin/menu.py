"""–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∞–¥–º–∏–Ω–∞: –¥–æ—Å—Ç—É–ø –∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –ø—Ä–æ–º–æ–∫–æ–¥–∞–º, –ª–æ–≥–∞–º, —ç–∫—Å–ø–æ—Ä—Ç—É, —Ç–∞—Ä–∏—Ñ–∞–º –∏ —Ä–∞—Å—Å—ã–ª–∫–∞–º."""

from aiogram import F, Router
from aiogram.filters import Command
from aiogram.types import Message, CallbackQuery
from aiogram.utils.keyboard import InlineKeyboardBuilder, InlineKeyboardButton

from config import ADMINS

router = Router()


def get_admin_menu_keyboard():
    """–§–æ—Ä–º–∏—Ä—É–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –≥–ª–∞–≤–Ω–æ–π –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏."""
    builder = InlineKeyboardBuilder()
    builder.row(InlineKeyboardButton(text="üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data="stats"))
    builder.row(InlineKeyboardButton(text="üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏", callback_data="manage_users"))
    builder.row(InlineKeyboardButton(text="üéü –ü—Ä–æ–º–æ–∫–æ–¥—ã", callback_data="promocode_menu"))
    builder.row(InlineKeyboardButton(text="üì¶ –í—ã–≥—Ä—É–∑–∏—Ç—å –ª–æ–≥–∏", callback_data="get_logs"))
    builder.row(InlineKeyboardButton(text="üìä –≠–∫—Å–ø–æ—Ä—Ç —Ç–∞–±–ª–∏—Ü—ã", callback_data="export_table_menu"))
    builder.row(InlineKeyboardButton(text="üí≥ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞–º–∏", callback_data="tariff_menu"))
    builder.row(InlineKeyboardButton(text="üì¢ –ö–∞–Ω–∞–ª—ã", callback_data="channels_menu"))
    builder.row(
        InlineKeyboardButton(text="üì® –û–±—ã—á–Ω–∞—è", callback_data="broadcast_start"),
        InlineKeyboardButton(text="üí∏ –†–µ–∫–ª–∞–º–Ω–∞—è", callback_data="ad_broadcast_start"),
        InlineKeyboardButton(text="üéØ –ù–µ–ø–ª–∞—Ç–∏–≤—à–∏–µ", callback_data="trial_broadcast_start")
    )
    return builder.as_markup()


@router.message(Command("admin"))
async def admin_panel(message: Message):
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É /admin, –æ—Ç–æ–±—Ä–∞–∂–∞—è –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞."""
    if message.from_user.id not in ADMINS:
        return await message.answer("‚õîÔ∏è –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ.")

    await message.answer("üîê –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å", reply_markup=get_admin_menu_keyboard())


@router.callback_query(F.data == "promocode_menu")
async def promocode_menu_entry(callback: CallbackQuery):
    """–ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—Ö–æ–¥ –≤ –º–µ–Ω—é –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è."""
    from .promo import show_promo_menu
    await show_promo_menu(callback)



@router.callback_query(F.data == "manage_users")
async def manage_users_menu(callback: CallbackQuery):
    """–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏."""
    builder = InlineKeyboardBuilder()
    builder.row(InlineKeyboardButton(text="üë• –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏", callback_data="all_users"))
    builder.row(InlineKeyboardButton(text="üîç –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è", callback_data="user_history_start"))
    builder.row(InlineKeyboardButton(text="üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π", callback_data="delete_all_users"))
    builder.row(InlineKeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data="admin_menu"))

    await callback.message.edit_text("–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:", reply_markup=builder.as_markup())
    await callback.answer()


@router.callback_query(F.data == "admin_menu")
async def back_to_admin_menu(callback: CallbackQuery):
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É '–ù–∞–∑–∞–¥', –≤–æ–∑–≤—Ä–∞—â–∞—è –∫ –≥–ª–∞–≤–Ω–æ–π –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏."""
    await callback.message.edit_text("üîê –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å", reply_markup=get_admin_menu_keyboard())
    await callback.answer()
