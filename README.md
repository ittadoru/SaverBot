# SaverTIYBot

@SaverTIYBot — это Telegram-бот для скачивания видео и аудио с YouTube, TikTok и Instagram. Бот поддерживает подписки, лимиты, промокоды, а также удобную систему поддержки пользователей и администрирования.

## Возможности

- Скачивание видео с YouTube, TikTok, Instagram
- Скачивание аудио из YouTube-видео
- Выбор качества видео (для подписчиков)
- Без рекламы для подписчиков
- Видео больше 50 МБ хранятся на сервере, выдаётся ссылка на скачивание
- Видео на сервере хранятся 5 минут (или дольше для подписчиков)
- Лимит 20 скачиваний в день (или безлимит для подписчиков)
- Поддержка промокодов (при первом запуске — бесплатная неделя)
- Система поддержки: тикеты в отдельной Telegram-группе, диалог через темы
- Админ-панель: редактор тарифов, просмотр статистики, управление пользователями

## Быстрый старт
### Хранение данных Redis

Redis в Docker сохраняет все данные в volume (раздел volumes в docker-compose.yaml). Это значит, что ваши пользователи, подписки, лимиты и статистика не пропадут при перезапуске или выключении сервера — данные сохраняются на диск.

**Важно:**
- Если вы удалите volume (`docker-compose down -v`), все данные будут потеряны.
- По умолчанию Redis сохраняет данные через механизм snapshot (RDB) — снимки делаются каждые несколько минут или при большом количестве изменений.
- Для максимальной надёжности можно включить режим append-only file (AOF), чтобы каждая операция сохранялась на диск. Для этого создайте файл `redis.conf` с содержимым:
  ```
  appendonly yes
  appendfsync everysec
  ```
  и добавьте в docker-compose.yaml для сервиса redis:
  ```yaml
  volumes:
    - redis_data:/data
    - ./redis.conf:/usr/local/etc/redis/redis.conf:ro
  command: ["redis-server", "/usr/local/etc/redis/redis.conf"]
  ```
  Теперь даже при аварийном выключении сервера потеряете максимум 1 секунду изменений.

Вы можете запустить бота двумя способами: через консоль или с помощью Docker.

### Через консоль
1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/ittadoru/SaverBot.git
   cd SaverBot
   ```
2. Создайте и активируйте виртуальное окружение:
   ```bash
   python -m venv venv
   source venv/bin/activate  # или venv\Scripts\activate на Windows
   ```
3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
4. Создайте файл `.env` и укажите переменные окружения (см. ниже).
5. Запустите бота:
   ```bash
   python bot.py
   ```
6. Запустите сервер FastAPI для хранения видео более 50МБ, а так же для обработки сообщения от YooKassa
   ```
   uvicorn server:app --port 8000
   ```

### Через Docker
1. Ознакомьтесь с инструкцией в файле `docker-compose.yaml`.
2. Запустите:
   ```bash
   docker-compose up --build
   ```

## Переменные окружения

Все переменные описаны в `config.py`. Основные:

- `BOT_TOKEN` — токен Telegram-бота
- `REDIS_URL` — адрес Redis
- `ADMINS` — список Telegram ID администраторов через запятую
- `USE_PYTUBE` — использовать ли pytube для YouTube (True/False)
- `DOMAIN` - ваш домен (пример https://example.com или если локально 127.0.0.1:8000)

## Структура проекта

- `handlers/` — обработчики команд, меню, профиля, подписки, истории
- `utils/` — работа с Redis, логгер, промокоды, поддержка
- `services/` — загрузчики видео с разных платформ
- `states/` — состояния FSM для диалогов и админки
- `config.py`, `docker-compose.yaml`, `requirements.txt` — конфигурация и зависимости

## FAQ

**Почему есть лимиты на скачивания?**  
Чтобы бот работал стабильно для всех пользователей и не был заблокирован платформами.

**Как получить подписку?**  
Откройте профиль в боте и выберите подходящий тариф. Оплата происходит через YooKassa.

**Как работает поддержка?**  
В боте есть кнопка для связи с поддержкой. Ваше сообщение автоматически создаёт тикет в отдельной Telegram-группе, где администратор ответит вам лично.

**Как активировать промокод?**  
В меню профиля есть пункт для ввода промокода. При первом запуске бот выдаёт бесплатный промокод на неделю.

**Что делать, если бот не скачивает видео?**  
Проверьте ссылку и попробуйте ещё раз. Если проблема не решилась — напишите в поддержку через бота.

## Контакты и поддержка

По всем вопросам и предложениям пишите автору: [@ittadoru]

Для связи с поддержкой используйте соответствующую кнопку в боте — тикет создаётся автоматически.
